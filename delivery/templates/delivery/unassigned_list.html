{% extends 'base/base.html' %}
{% block title %}未配車リスト{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>未配車リスト</h2>

    <form method="post" action="{% url 'delivery:bulk_assign' %}" id="assign-form">
        {% csrf_token %}

        <div class="row mb-3">
            <div class="col-md-3">
                <label for="vehicle" class="form-label">車両選択</label>
                <select name="vehicle" id="vehicle" class="form-select" required>
                    <option value="">-- 車両を選択 --</option>
                    {% for v in vehicles %}
                        <option value="{{ v.pk }}">{{ v.vehicle_number }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label for="delivery_date" class="form-label">配送日</label>
                <input type="date" name="delivery_date" id="delivery_date"
                       class="form-control" value="{{ target_date|date:'Y-m-d' }}" required>
            </div>
            <div class="col-md-3 d-flex align-items-end">
                <button type="submit" class="btn btn-primary">選択した未配車を一括配車</button>
            </div>
        </div>

        <table class="table table-bordered table-striped">
            <thead class="table-dark">
                <tr>
                    <th><input type="checkbox" id="check-all"></th>
                    <th>注文No</th>
                    <th>製品名</th>
                    <th>届先</th>
                    <th>数量</th>
                    <th>納期</th>
                </tr>
            </thead>
            <tbody>
                {% for s in schedules %}
                    <tr>
                        <td><input type="checkbox" name="schedule_pks" value="{{ s.pk }}"></td>
                        <td>{{ s.order_item.order.order_number }}</td>
                        <td>{{ s.order_item.product.name }}</td>
                        <td>{{ s.order_item.order.delivery.name }}</td>
                        <td>{{ s.order_item.quantity }}</td>
                        <td>{{ s.order_item.delivery_date }}</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="6">未配車データはありません。</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </form>    
</div>

<script>
    // 全選択チェックボックス
    document.getElementById('check-all').addEventListener('change', function() {
        const checked = this.checked;
        document.querySelectorAll('input[name="schedule_pks"]').forEach(cb => cb.checked = checked);
    });
</script>
{% endblock %}